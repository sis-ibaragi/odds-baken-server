!function(n){var t={};function e(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return n[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=n,e.c=t,e.d=function(n,t,r){e.o(n,t)||Object.defineProperty(n,t,{enumerable:!0,get:r})},e.r=function(n){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,t){if(1&t&&(n=e(n)),8&t)return n;if(4&t&&"object"==typeof n&&n&&n.__esModule)return n;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:n}),2&t&&"string"!=typeof n)for(var o in n)e.d(r,o,function(t){return n[t]}.bind(null,o));return r},e.n=function(n){var t=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(t,"a",t),t},e.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},e.p="",e(e.s=12)}([function(n,t){n.exports=require("fs")},function(n,t,e){"use strict";var r;e.d(t,"a",function(){return r}),function(n){n.HOST="localhost",n.USER="appuser01",n.PASSWORD="p@ssw0rd",n.DATABASE="appdb01",n.CONNECTION_LIMIT=10}(r||(r={}))},function(n,t){n.exports=require("express")},function(n,t,e){"use strict";e.d(t,"a",function(){return u});var r=e(4),o=function(n,t,e,r){return new(e||(e=Promise))(function(o,a){function u(n){try{s(r.next(n))}catch(n){a(n)}}function i(n){try{s(r.throw(n))}catch(n){a(n)}}function s(n){n.done?o(n.value):new e(function(t){t(n.value)}).then(u,i)}s((r=r.apply(n,t||[])).next())})},a=function(n,t){var e,r,o,a,u={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function i(a){return function(i){return function(a){if(e)throw new TypeError("Generator is already executing.");for(;u;)try{if(e=1,r&&(o=2&a[0]?r.return:a[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,a[1])).done)return o;switch(r=0,o&&(a=[2&a[0],o.value]),a[0]){case 0:case 1:o=a;break;case 4:return u.label++,{value:a[1],done:!1};case 5:u.label++,r=a[1],a=[0];continue;case 7:a=u.ops.pop(),u.trys.pop();continue;default:if(!(o=(o=u.trys).length>0&&o[o.length-1])&&(6===a[0]||2===a[0])){u=0;continue}if(3===a[0]&&(!o||a[1]>o[0]&&a[1]<o[3])){u.label=a[1];break}if(6===a[0]&&u.label<o[1]){u.label=o[1],o=a;break}if(o&&u.label<o[2]){u.label=o[2],u.ops.push(a);break}o[2]&&u.ops.pop(),u.trys.pop();continue}a=t.call(n,u)}catch(n){a=[6,n],r=0}finally{e=o=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,i])}}},u=function(){function n(){}return n.prototype.createPool=function(n,t,e,u,i){return o(this,void 0,void 0,function(){var o;return a(this,function(a){switch(a.label){case 0:return o=this,[4,r.createPool({host:n,user:t,password:e,database:u,connectionLimit:i})];case 1:return o.pool=a.sent(),[2]}})})},n.prototype.getConnection=function(){return this.pool.getConnection()},n.prototype.releaseConnection=function(n){this.pool.releaseConnection(n)},n}()},function(n,t){n.exports=require("promise-mysql")},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){this.prevUmrnOddsRecord=null}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.d(t,"a",function(){return r});var r=function(){return function(){}}()},function(n,t,e){"use strict";e.r(t),function(n){var r=e(2),o=e(3),a=e(1),u=e(0),i=e(5),s=e(6),c=e(7),l=e(8),f=e(9),d=e(10),p=e(11),_=r(),N=new o.a;_.use(function(n,t,e){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),t.header("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),e()}),_.get("/",function(t,e,r){return e.send(process.cwd()+" | "+n)}),_.get("/kaisai/dates",function(n,t,e){var r;N.getConnection().then(function(n){r=n;var t=u.readFileSync(process.cwd()+"/sql/select_kaisai_dt_list.sql","utf8");return n.query(t)}).then(function(n){var e=Array();n.forEach(function(n){e.push(n.KAISAI_DT)}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/summary/:date",function(n,t,e){var r;N.getConnection().then(function(t){r=t;var e=u.readFileSync(process.cwd()+"/sql/select_odds_summary_list.sql","utf8");return t.query(e,[1,n.params.date])}).then(function(n){var e=Array();n.forEach(function(n){var t=new i.a;t.kaisaiCd=n.KAISAI_CD,t.kaisaiNm=n.KAISAI_NM,t.raceNo=n.RACE_NO,t.umaCnt=n.UMA_NUM,t.tnpkOddsTime=n.TNPK_ODDS_TIME,t.umrnOddsTime=n.UMRN_ODDS_TIME,t.umrn1Odds=n.UMRN_ODDS,t.tan10Odds=n.TAN_ODDS,t.fuku8Odds=n.FUKU_ODDS_MAX,t.umrnAnaFlg=1===n.UMRN_FLG,t.tanAnaFlg=1===n.TAN_FLG,t.fukuAnaFlg=1===n.FUKU_FLG,t.umrnAnaFlg&&t.tanAnaFlg&&t.fukuAnaFlg?t.anaFlgCnt=3:t.umrnAnaFlg&&t.tanAnaFlg?t.anaFlgCnt=2:(t.umrnAnaFlg||t.tanAnaFlg)&&t.fukuAnaFlg?t.anaFlgCnt=1.5:(t.umrnAnaFlg||t.tanAnaFlg)&&(t.anaFlgCnt=1),e.push(t)}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/kaisai/:kaisaiCd",function(n,t,e){var r;N.getConnection().then(function(t){r=t;var e=u.readFileSync(process.cwd()+"/sql/select_kaisai_info.sql","utf8");return t.query(e,[n.params.kaisaiCd])}).then(function(n){var e=n[0],r=new l.a;r.kaisaiCd=e.KAISAI_CD,r.kaisaiNm=e.KAISAI_NM,r.kaisaiDt=e.KAISAI_DT,t.json(r)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/:kaisaiCd/:raceNo/odds-times",function(n,t,e){var r;N.getConnection().then(function(t){r=t;var e=u.readFileSync(process.cwd()+"/sql/select_odds_time_list.sql","utf8");return t.query(e,[n.params.kaisaiCd,n.params.raceNo])}).then(function(n){var e=new Array;n.forEach(function(n){var t=new s.a;t.oddsTimeNo=n.ODDS_TIME_NO,t.tnpkOddsTime=n.TNPK_ODDS_TIME,t.umrnOddsTime=n.UMRN_ODDS_TIME,e.push(t)}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/:kaisaiCd/:raceNo/:oddsTimeNo/tan",function(n,t,e){var r,o=n.params.kaisaiCd,a=n.params.raceNo,i=n.params.oddsTimeNo;N.getConnection().then(function(n){r=n;var t=u.readFileSync(process.cwd()+"/sql/select_odds_umrn_rank1_list.sql","utf8");return n.query(t,[o,a,i,o,a,i])}).then(function(n){var t=n[0].UMA_NO,e=u.readFileSync(process.cwd()+"/sql/select_odds_tan_list.sql","utf8");return r.query(e,[o,a,i,t,o,a,i,t,o,a,i])}).then(function(n){var e=new Array;n.forEach(function(n){var t=new f.a;t.ninkiNo=n.NINKI_NO,t.umaNo=n.UMA_NO,t.tanOdds=n.TAN_ODDS;var r=n.UMRN_NINKI_NO;t.idoFlg=t.ninkiNo<=r-5,e.push(t)}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/:kaisaiCd/:raceNo/:oddsTimeNo/fuku",function(n,t,e){var r,o=n.params.kaisaiCd,a=n.params.raceNo,i=n.params.oddsTimeNo;N.getConnection().then(function(n){r=n;var t=u.readFileSync(process.cwd()+"/sql/select_odds_umrn_rank1_list.sql","utf8");return n.query(t,[o,a,i,o,a,i])}).then(function(n){var t=n[0].UMA_NO,e=u.readFileSync(process.cwd()+"/sql/select_odds_fuku_list.sql","utf8");return r.query(e,[o,a,i,t,o,a,i,t,o,a,i])}).then(function(n){var e=new Array;n.forEach(function(n){var t=new d.a;t.ninkiNo=n.NINKI_NO,t.umaNo=n.UMA_NO,t.fukuOdds=n.FUKU_ODDS_MAX;var r=n.UMRN_NINKI_NO;t.idoFlg=t.ninkiNo<=r-5,e.push(t)}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/:kaisaiCd/:raceNo/:oddsTimeNo/umrn",function(n,t,e){var r,o=n.params.kaisaiCd,a=n.params.raceNo,i=n.params.oddsTimeNo;N.getConnection().then(function(n){r=n;var t=u.readFileSync(process.cwd()+"/sql/select_odds_umrn_rank1_list.sql","utf8");return n.query(t,[o,a,i,o,a,i])}).then(function(n){var t=n[0].UMA_NO,e=u.readFileSync(process.cwd()+"/sql/select_odds_umrn_list.sql","utf8");return r.query(e,[o,a,i,t,o,a,i,t,t])}).then(function(n){var e=new Array,r=null;n.forEach(function(n){var t=new c.a;t.ninkiNo=n.NINKI_NO,t.umaNo=n.UMA_NO,t.umrnOdds=n.UMRN_ODDS,t.prevUmrnOddsRecord=r,e.push(t),null!==r&&null!==r.umrnOdds&&null!==t.umrnOdds&&(r.diffRt=t.umrnOdds/r.umrnOdds,r.ninkiNo<=8?r.kabeCd=r.diffRt>=1.8?"01":null:(r.kabeCd=r.diffRt>=1.8?"10":null,null!==r.kabeCd&&(r.prevUmrnOddsRecord.kabeCd=r.kabeCd))),r=t}),t.json(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.get("/odds/:kaisaiCd/:raceNo/:oddsTimeNo/diff",function(n,t,e){var r,o=n.params.kaisaiCd,a=n.params.raceNo,i=n.params.oddsTimeNo;N.getConnection().then(function(n){r=n;var t=u.readFileSync(process.cwd()+"/sql/select_odds_tnpk_time_diff.sql","utf8");return n.query(t,[o,a,i-1,i])}).then(function(n){var e=new Array;return n.forEach(function(n){var t=new p.a;t.umaNo=n.UMA_NO,t.tanOdds1=n.TAN_ODDS_1,t.tanOdds2=n.TAN_ODDS_2,t.fukuOdds1=n.FUKU_ODDS_MAX_1,t.fukuOdds2=n.FUKU_ODDS_MAX_2,t.tanUpRt=t.tanOdds1/t.tanOdds2,t.tanUpFlg=t.tanUpRt>1,t.fukuUpRt=t.fukuOdds1/t.fukuOdds2,t.fukuUpFlg=t.fukuUpRt>1,e.push(t)}),t.json(e),console.log(e)}).catch(function(n){console.error(n),t.status(500).json({})}).finally(function(){N.releaseConnection(r)})}),_.listen(3e3,function(){N.createPool(a.a.HOST,a.a.USER,a.a.PASSWORD,a.a.DATABASE,a.a.CONNECTION_LIMIT).then(function(){console.log("listening on port 3000...")}).catch(function(n){throw n})}),t.default=_}.call(this,"/")}]);
//# sourceMappingURL=server.js.map